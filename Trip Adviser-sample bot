%%writefile app.py
import streamlit as st
from openai import OpenAI

class Page:
    def __init__(self):
        from secret_keys import openai_api_key
        self.client = OpenAI(api_key=openai_api_key)

        prompt = """
        Take the role of an experienced trip adviser who  is specializes in assisting unique travel experiences.
        You have extensive knowledge about various destinations, have read widely on travel trends,
        and understand the difficulty of planning memorable trips for diverse preferences.
        """

        
        if "trip_adviser_messages" not in st.session_state:
            st.session_state["trip_adviser_messages"] = [
                {"role": "system", "content": prompt}
            ]

        
        def communicate():
            messages = st.session_state["trip_adviser_messages"]

            user_message = {"role": "user", "content": st.session_state["user_input"]}
            messages.append(user_message)

            response = self.client.chat.completions.create(
                model="gpt-3.5-turbo",
                messages=messages
            )
            bot_message = response.choices[0].message
            messages.append(bot_message)

            st.session_state["user_input"] = ""

        
        st.title("Trip Adviser AI")
        st.image("tripAdviser.png")
        st.write("Discover, Plan, and Explore Seamlessly.")

        user_input = st.text_input("Please enter a message here.", key="user_input", on_change=communicate)

        if st.session_state["trip_adviser_messages"]:
            messages = st.session_state["trip_adviser_messages"]

            for message in reversed(messages[1:]):
                if isinstance(message, dict):
                    speaker = "😎" if message["role"] == "user" else "🤖"
                    st.write(speaker + ": " + message["content"])
                else:
                    st.write("🤖: " + message.content)
